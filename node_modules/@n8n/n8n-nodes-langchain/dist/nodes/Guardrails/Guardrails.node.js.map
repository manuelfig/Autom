{"version":3,"sources":["../../../nodes/Guardrails/Guardrails.node.ts"],"sourcesContent":["import type { IExecuteFunctions, INodeExecutionData, INodeType } from 'n8n-workflow';\n\nimport { process } from './actions/process';\nimport { versionDescription } from './description';\nimport { getChatModel } from './helpers/model';\n\nexport class Guardrails implements INodeType {\n\tdescription = versionDescription;\n\n\tasync execute(this: IExecuteFunctions): Promise<INodeExecutionData[][]> {\n\t\tconst items = this.getInputData();\n\t\tconst operation = this.getNodeParameter('operation', 0) as 'classify' | 'sanitize';\n\t\tconst model = operation === 'classify' ? await getChatModel.call(this) : null;\n\n\t\tconst failedItems: INodeExecutionData[] = [];\n\t\tconst passedItems: INodeExecutionData[] = [];\n\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\ttry {\n\t\t\t\tconst responseData = await process.call(this, i, model);\n\t\t\t\tif (responseData.passed) {\n\t\t\t\t\tpassedItems.push({\n\t\t\t\t\t\tjson: { guardrailsInput: responseData.guardrailsInput, ...responseData.passed },\n\t\t\t\t\t\tpairedItem: { item: i },\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (responseData.failed) {\n\t\t\t\t\tfailedItems.push({\n\t\t\t\t\t\tjson: { guardrailsInput: responseData.guardrailsInput, ...responseData.failed },\n\t\t\t\t\t\tpairedItem: { item: i },\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tif (this.continueOnFail()) {\n\t\t\t\t\tfailedItems.push({\n\t\t\t\t\t\tjson: { error: error.message, guardrailsInput: '' },\n\t\t\t\t\t\tpairedItem: { item: i },\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (operation === 'classify') {\n\t\t\treturn [passedItems, failedItems];\n\t\t}\n\n\t\treturn [passedItems];\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,qBAAwB;AACxB,yBAAmC;AACnC,mBAA6B;AAEtB,MAAM,WAAgC;AAAA,EAAtC;AACN,uBAAc;AAAA;AAAA,EAEd,MAAM,UAAkE;AACvE,UAAM,QAAQ,KAAK,aAAa;AAChC,UAAM,YAAY,KAAK,iBAAiB,aAAa,CAAC;AACtD,UAAM,QAAQ,cAAc,aAAa,MAAM,0BAAa,KAAK,IAAI,IAAI;AAEzE,UAAM,cAAoC,CAAC;AAC3C,UAAM,cAAoC,CAAC;AAC3C,aAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACtC,UAAI;AACH,cAAM,eAAe,MAAM,uBAAQ,KAAK,MAAM,GAAG,KAAK;AACtD,YAAI,aAAa,QAAQ;AACxB,sBAAY,KAAK;AAAA,YAChB,MAAM,EAAE,iBAAiB,aAAa,iBAAiB,GAAG,aAAa,OAAO;AAAA,YAC9E,YAAY,EAAE,MAAM,EAAE;AAAA,UACvB,CAAC;AAAA,QACF;AACA,YAAI,aAAa,QAAQ;AACxB,sBAAY,KAAK;AAAA,YAChB,MAAM,EAAE,iBAAiB,aAAa,iBAAiB,GAAG,aAAa,OAAO;AAAA,YAC9E,YAAY,EAAE,MAAM,EAAE;AAAA,UACvB,CAAC;AAAA,QACF;AAAA,MACD,SAAS,OAAO;AACf,YAAI,KAAK,eAAe,GAAG;AAC1B,sBAAY,KAAK;AAAA,YAChB,MAAM,EAAE,OAAO,MAAM,SAAS,iBAAiB,GAAG;AAAA,YAClD,YAAY,EAAE,MAAM,EAAE;AAAA,UACvB,CAAC;AAAA,QACF,OAAO;AACN,gBAAM;AAAA,QACP;AAAA,MACD;AAAA,IACD;AAEA,QAAI,cAAc,YAAY;AAC7B,aAAO,CAAC,aAAa,WAAW;AAAA,IACjC;AAEA,WAAO,CAAC,WAAW;AAAA,EACpB;AACD;","names":[]}