{"version":3,"sources":["../../../../nodes/Guardrails/helpers/mappers.ts"],"sourcesContent":["import omit from 'lodash/omit';\n\nimport { GuardrailError, type GuardrailResult, type GuardrailUserResult } from '../actions/types';\n\nexport const mapGuardrailResultToUserResult = (\n\tresult: GuardrailResult | PromiseSettledResult<GuardrailResult>,\n): GuardrailUserResult => {\n\tconst formatInfo = (info?: Record<string, unknown>) => {\n\t\treturn omit(info ?? {}, ['maskEntities']);\n\t};\n\tif ('status' in result) {\n\t\tif (result.status === 'fulfilled') {\n\t\t\treturn {\n\t\t\t\tname: result.value.guardrailName,\n\t\t\t\ttriggered: result.value.tripwireTriggered,\n\t\t\t\tconfidenceScore: result.value.confidenceScore,\n\t\t\t\texecutionFailed: result.value.executionFailed,\n\t\t\t\texception: result.value.originalException\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tname: result.value.originalException.name,\n\t\t\t\t\t\t\tdescription: result.value.originalException.message,\n\t\t\t\t\t\t}\n\t\t\t\t\t: undefined,\n\t\t\t\tinfo: formatInfo(result.value.info),\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tname:\n\t\t\t\t\tresult.reason instanceof GuardrailError\n\t\t\t\t\t\t? result.reason.guardrailName\n\t\t\t\t\t\t: 'Unknown Guardrail',\n\t\t\t\ttriggered: true,\n\t\t\t\texecutionFailed: true,\n\t\t\t\texception:\n\t\t\t\t\tresult.reason instanceof Error\n\t\t\t\t\t\t? { name: result.reason.name, description: result.reason.message }\n\t\t\t\t\t\t: { name: 'Unknown Exception', description: 'Unknown exception occurred' },\n\t\t\t};\n\t\t}\n\t}\n\treturn {\n\t\tname: result.guardrailName,\n\t\ttriggered: result.tripwireTriggered,\n\t\tconfidenceScore: result.confidenceScore,\n\t\texecutionFailed: result.executionFailed,\n\t\texception: result.originalException\n\t\t\t? {\n\t\t\t\t\tname: result.originalException.name,\n\t\t\t\t\tdescription: result.originalException.message,\n\t\t\t\t}\n\t\t\t: undefined,\n\t\tinfo: formatInfo(result.info),\n\t};\n};\n\nexport const mapGuardrailErrorsToMessage = (\n\tresults: Array<PromiseSettledResult<GuardrailResult>>,\n) => {\n\tconst failedChecks = results\n\t\t.filter((r) => r.status === 'rejected' || (r.status === 'fulfilled' && r.value.executionFailed))\n\t\t.map((result) => {\n\t\t\tconst originalException =\n\t\t\t\tresult.status === 'rejected' ? result.reason : result.value.originalException;\n\t\t\tconst message = originalException?.message ?? 'Unknown exception occurred';\n\t\t\tconst guardrailName =\n\t\t\t\tresult.status === 'rejected'\n\t\t\t\t\t? (originalException?.guardrailName ?? 'Unknown Guardrail')\n\t\t\t\t\t: result.value.guardrailName;\n\t\t\treturn `${guardrailName} - ${message}`;\n\t\t})\n\t\t.join(',\\n');\n\treturn `Failed checks:\\n${failedChecks}`;\n};\n\nexport const wrapResultsToNodeExecutionData = (\n\tchecks: GuardrailUserResult[],\n\titemIndex: number,\n) => {\n\treturn checks.length > 0\n\t\t? [\n\t\t\t\t{\n\t\t\t\t\tjson: { checks },\n\t\t\t\t\tpairedItem: { item: itemIndex },\n\t\t\t\t},\n\t\t\t]\n\t\t: [];\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAiB;AAEjB,mBAA+E;AAExE,MAAM,iCAAiC,CAC7C,WACyB;AACzB,QAAM,aAAa,CAAC,SAAmC;AACtD,eAAO,YAAAA,SAAK,QAAQ,CAAC,GAAG,CAAC,cAAc,CAAC;AAAA,EACzC;AACA,MAAI,YAAY,QAAQ;AACvB,QAAI,OAAO,WAAW,aAAa;AAClC,aAAO;AAAA,QACN,MAAM,OAAO,MAAM;AAAA,QACnB,WAAW,OAAO,MAAM;AAAA,QACxB,iBAAiB,OAAO,MAAM;AAAA,QAC9B,iBAAiB,OAAO,MAAM;AAAA,QAC9B,WAAW,OAAO,MAAM,oBACrB;AAAA,UACA,MAAM,OAAO,MAAM,kBAAkB;AAAA,UACrC,aAAa,OAAO,MAAM,kBAAkB;AAAA,QAC7C,IACC;AAAA,QACH,MAAM,WAAW,OAAO,MAAM,IAAI;AAAA,MACnC;AAAA,IACD,OAAO;AACN,aAAO;AAAA,QACN,MACC,OAAO,kBAAkB,8BACtB,OAAO,OAAO,gBACd;AAAA,QACJ,WAAW;AAAA,QACX,iBAAiB;AAAA,QACjB,WACC,OAAO,kBAAkB,QACtB,EAAE,MAAM,OAAO,OAAO,MAAM,aAAa,OAAO,OAAO,QAAQ,IAC/D,EAAE,MAAM,qBAAqB,aAAa,6BAA6B;AAAA,MAC5E;AAAA,IACD;AAAA,EACD;AACA,SAAO;AAAA,IACN,MAAM,OAAO;AAAA,IACb,WAAW,OAAO;AAAA,IAClB,iBAAiB,OAAO;AAAA,IACxB,iBAAiB,OAAO;AAAA,IACxB,WAAW,OAAO,oBACf;AAAA,MACA,MAAM,OAAO,kBAAkB;AAAA,MAC/B,aAAa,OAAO,kBAAkB;AAAA,IACvC,IACC;AAAA,IACH,MAAM,WAAW,OAAO,IAAI;AAAA,EAC7B;AACD;AAEO,MAAM,8BAA8B,CAC1C,YACI;AACJ,QAAM,eAAe,QACnB,OAAO,CAAC,MAAM,EAAE,WAAW,cAAe,EAAE,WAAW,eAAe,EAAE,MAAM,eAAgB,EAC9F,IAAI,CAAC,WAAW;AAChB,UAAM,oBACL,OAAO,WAAW,aAAa,OAAO,SAAS,OAAO,MAAM;AAC7D,UAAM,UAAU,mBAAmB,WAAW;AAC9C,UAAM,gBACL,OAAO,WAAW,aACd,mBAAmB,iBAAiB,sBACrC,OAAO,MAAM;AACjB,WAAO,GAAG,aAAa,MAAM,OAAO;AAAA,EACrC,CAAC,EACA,KAAK,KAAK;AACZ,SAAO;AAAA,EAAmB,YAAY;AACvC;AAEO,MAAM,iCAAiC,CAC7C,QACA,cACI;AACJ,SAAO,OAAO,SAAS,IACpB;AAAA,IACA;AAAA,MACC,MAAM,EAAE,OAAO;AAAA,MACf,YAAY,EAAE,MAAM,UAAU;AAAA,IAC/B;AAAA,EACD,IACC,CAAC;AACL;","names":["omit"]}