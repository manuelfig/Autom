{"version":3,"sources":["../../../../nodes/Guardrails/actions/types.ts"],"sourcesContent":["import type { BaseChatModel } from '@langchain/core/language_models/chat_models';\nimport type { PIIEntity } from './checks/pii';\n\nexport interface GuardrailResult<TInfo extends Record<string, unknown> = Record<string, unknown>> {\n\t/** The name of the guardrail. */\n\tguardrailName: string;\n\t/** True if the guardrail identified a critical failure. */\n\ttripwireTriggered: boolean;\n\t/** The confidence score of the guardrail. */\n\tconfidenceScore?: number;\n\t/** True if the guardrail failed to execute properly. */\n\texecutionFailed?: boolean;\n\t/** The original exception if execution failed. */\n\toriginalException?: Error;\n\t/** Additional structured data about the check result,\n        such as error details, matched patterns, or diagnostic messages.\n        Must include checked_text field containing the processed text. */\n\tinfo: TInfo & {\n\t\tmaskEntities?: Record<string, string[]>;\n\t};\n}\n\nexport type LLMConfig = {\n\tmodel: BaseChatModel;\n\tsystemMessage?: string;\n\tprompt: string;\n\tthreshold: number;\n};\n\nexport type CheckFn<TInfo extends Record<string, unknown> = Record<string, unknown>> = (\n\tinput: string,\n) => GuardrailResult<TInfo> | Promise<GuardrailResult<TInfo>>;\n\nexport type CreateCheckFn<\n\tTCfg = object,\n\tTInfo extends Record<string, unknown> = Record<string, unknown>,\n> = (config: TCfg) => CheckFn<TInfo>;\n\ntype Value<T> = {\n\tvalue?: T;\n};\n\nexport type CustomRegex = {\n\tname: string;\n\tvalue: string;\n};\n\nexport interface GuardrailsOptions {\n\tkeywords?: string;\n\tjailbreak?: Value<{\n\t\tprompt?: string;\n\t\tthreshold: number;\n\t}>;\n\tnsfw?: Value<{\n\t\tprompt?: string;\n\t\tthreshold: number;\n\t}>;\n\tpii?: Value<{\n\t\ttype: 'all' | 'selected';\n\t\tentities?: PIIEntity[];\n\t}>;\n\turls?: Value<{\n\t\tallowedUrls: string;\n\t\tallowedSchemes: string[];\n\t\tblockUserinfo: boolean;\n\t\tallowSubdomains: boolean;\n\t}>;\n\tsecretKeys?: Value<{\n\t\tpermissiveness: 'strict' | 'balanced' | 'permissive';\n\t}>;\n\ttopicalAlignment?: Value<{\n\t\tprompt?: string;\n\t\tthreshold: number;\n\t}>;\n\tcustom?: {\n\t\tguardrail: Array<{\n\t\t\tname: string;\n\t\t\tprompt: string;\n\t\t\tthreshold: number;\n\t\t}>;\n\t};\n\tcustomRegex?: {\n\t\tregex: CustomRegex[];\n\t};\n}\n\nexport interface GuardrailUserResult {\n\tname: string;\n\ttriggered: boolean;\n\tconfidenceScore?: number;\n\texecutionFailed?: boolean;\n\texception?: {\n\t\tname: string;\n\t\tdescription: string;\n\t};\n\tinfo?: Record<string, unknown>;\n}\n\nexport class GuardrailError extends Error {\n\tconstructor(\n\t\treadonly guardrailName: string,\n\t\tmessage: string,\n\t\treadonly description: string,\n\t) {\n\t\tsuper(message);\n\t}\n}\n\nexport interface StageGuardRails {\n\tpreflight: Array<{ name: string; check: CheckFn }>;\n\tinput: Array<{ name: string; check: CheckFn }>;\n}\nexport type GroupedGuardrailResults = {\n\tpassed: Array<PromiseFulfilledResult<GuardrailResult>>;\n\tfailed: Array<PromiseRejectedResult | PromiseFulfilledResult<GuardrailResult>>;\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAkGO,MAAM,uBAAuB,MAAM;AAAA,EACzC,YACU,eACT,SACS,aACR;AACD,UAAM,OAAO;AAJJ;AAEA;AAAA,EAGV;AACD;","names":[]}