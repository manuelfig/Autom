{"version":3,"sources":["../../utils/httpProxyAgent.ts"],"sourcesContent":["import { HttpsProxyAgent } from 'https-proxy-agent';\nimport proxyFromEnv from 'proxy-from-env';\nimport { ProxyAgent } from 'undici';\n\n/**\n * Resolves the proxy URL from environment variables for a given target URL.\n *\n * @param targetUrl - The target URL to check proxy configuration for (optional)\n * @returns The proxy URL string or undefined if no proxy is configured\n *\n * @remarks\n * There are cases where we don't know the target URL in advance (e.g. when we need to provide a proxy agent to ChatAwsBedrock).\n * In such case we use a dummy URL.\n * This will lead to `NO_PROXY` environment variable not being respected, but it is better than not having a proxy agent at all.\n */\nfunction getProxyUrlFromEnv(targetUrl?: string): string {\n\treturn proxyFromEnv.getProxyForUrl(targetUrl ?? 'https://example.nonexistent/');\n}\n\n/**\n * Returns a ProxyAgent or undefined based on the environment variables and target URL.\n * When target URL is not provided, NO_PROXY environment variable is not respected.\n */\nexport function getProxyAgent(targetUrl?: string) {\n\tconst proxyUrl = getProxyUrlFromEnv(targetUrl);\n\n\tif (!proxyUrl) {\n\t\treturn undefined;\n\t}\n\n\treturn new ProxyAgent(proxyUrl);\n}\n\n/**\n * Returns a Node.js HTTP/HTTPS proxy agent for use with AWS SDK v3 clients.\n * AWS SDK v3 requires Node.js http.Agent/https.Agent instances (not undici ProxyAgent).\n *\n * @param targetUrl - The target URL to check proxy configuration for\n * @returns HttpsProxyAgent instance or undefined if no proxy is configured\n */\nexport function getNodeProxyAgent(targetUrl?: string) {\n\tconst proxyUrl = getProxyUrlFromEnv(targetUrl);\n\n\tif (!proxyUrl) {\n\t\treturn undefined;\n\t}\n\n\treturn new HttpsProxyAgent(proxyUrl);\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAgC;AAChC,4BAAyB;AACzB,oBAA2B;AAa3B,SAAS,mBAAmB,WAA4B;AACvD,SAAO,sBAAAA,QAAa,eAAe,aAAa,8BAA8B;AAC/E;AAMO,SAAS,cAAc,WAAoB;AACjD,QAAM,WAAW,mBAAmB,SAAS;AAE7C,MAAI,CAAC,UAAU;AACd,WAAO;AAAA,EACR;AAEA,SAAO,IAAI,yBAAW,QAAQ;AAC/B;AASO,SAAS,kBAAkB,WAAoB;AACrD,QAAM,WAAW,mBAAmB,SAAS;AAE7C,MAAI,CAAC,UAAU;AACd,WAAO;AAAA,EACR;AAEA,SAAO,IAAI,yCAAgB,QAAQ;AACpC;","names":["proxyFromEnv"]}